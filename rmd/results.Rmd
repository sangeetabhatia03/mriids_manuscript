# Processing ProMED/HealthMap data feed

We used a set of curated ProMED and HealthMap records on the human 
cases of 
Ebola in West Africa from ProMED were provided to the modeling
team. The dates in the feeds ranged from March 2014 to October 2016.
The data set recorded the cumulative number of suspected/confirmed
cases and suspected/confirmed deaths by country at various dates
in this period. We derived the country specific daily and 
weekly incidence time series from these data after the 
following data cleaning and pre-processing:

+ We first extracted the total case
counts as a sum of suspected and confirmed cases. 
+ Each unique record 
in ProMED/HealthMap data is associated with a unique alert id.  Where
multiple records were associated with the same alert id, we merged
them by assigning the median of the case numbers to the record. In
some instances, cumulative case count was inconsistent in that it
failed to be monotonically increasing. Any record of a 
cumulative case number lower than a previous record was removed.
+ Finally, cumulative incidence on days with no records was
filled in using linear or log-linear interpolation. 

Further details and result of 
each step of the pre-processing of Promed and 
Healthmap data are presented in the supplementary text.


## Results

## Comparison of incidence trends from different sources

We compared the processed country-specific incidence time 
series derived  from ProMED and HealthMap
data with the incidence data collated by WHO during the West 
African Ebola epidemic  made available by [@garske20160308], 
later referred to as ``the WHO data'' in the interest of brevity. 
Incidence time series and the reproduction numbers estimated using the
incidence from these various sources are shown in  
Figure \@ref(fig:incidrcompare) for the three mainly affected 
countries: Guinea, Liberia and Sierra Leone.  The instantaneous 
reproduction number was estimated independently for each country in
using the R package EpiEstim [@cori2013new]. 


The incidence time series derived from ProMED and HealthMap data are 
highly correlated with the WHO incidence data (Pearson's correlation
coefficient 0.44 and 0.74 respectively, p value < 0.001). The digital 
surveillance data differ significantly from the WHO data at the peak 
of the epidemic approximately in the first few months of 2015. While 
the reason for this discrepancy are not entirely clear, they could 
for instance reflect the susceptibility of digital surveillance to
biases in reporting. At the same time, it is important to remember
that the WHO data that used here is an extensively cleaned
version of the data collected during the epidemic [@who2014ebola, 
@team2015west], published well after the epidemic was declared to be 
over. The first situation Report by the WHO was published only at the
end of August 2014 [@whositrep]. On the other hand, the first post
on ProMED on Ebola cases in Guinea appears in March 2014 [@pmfirstebola]

```{r incidrcompare, echo = FALSE, fig.cap = "Comparison of daily incidence trends derived from ProMED, HealthMap and WHO data. The three time series exhibit a high degree of correlation.", fig.align = "center"}
knitr::include_graphics("ms-figures/who_hm_promed_compare.png")
```


## Short term projections

Figures \@(fig:guinea49, fig:liberia49, fig:sl49) show the
non-overlapping weekly forecasts for 4 weeks from the point of 
projection where effective 
reproduction number is being estimated for each 4 week window 
up to the point of projection. Results from the model using
1 week and 3 weeks time window are presented in the supplementary 
text. In each figure, panel (A) shows the projected weekly 
incidence overlaid on the observed weekly incidence. The middle 
panel shows the posterior distribution of the reproduction
number used for projection in the corresponding time frame. This
estimate uses only data available up to the point at which we
begin projecting forward. The last panel (C) in each figure 
shows the reproduction number estimated using all available data.


```{r guinea49, echo = FALSE, fig.cap = "(A) Weekly observed and predicted incidence in Guinea at different points during the outbreak. The reproduction number was estimated for each 4 week interval up to the point at which projection is done. (B) Effective reproduction number estimated in real-time using (C) Effective reproduction number estimated retrospectively.", fig.align = "center"}
knitr::include_graphics("ms-figures/GIN_21_637_14_28.png")
```


```{r liberia49, echo = FALSE, fig.cap = "Weekly observed and predicted incidence in Liberia at different points during the outbreak. The reproduction number was estimated for each 4 week interval up to the point at which projection is done. (B) Effective reproduction number estimated in real-time using (C) Effective reproduction number estimated retrospectively.", fig.align = "center"}
knitr::include_graphics("ms-figures/LBR_21_637_14_28.png")
```


```{r sl49, echo = FALSE, fig.cap = "Weekly observed and predicted incidence in Sierra Leone at different points during the outbreak. The reproduction number was estimated for each 4 week interval up to the point at which projection is done. (B) Effective reproduction number estimated in real-time using (C) Effective reproduction number estimated retrospectively.", fig.align = "center"}
knitr::include_graphics("ms-figures/SLE_21_637_14_28.png")
```

Figure \@(fig:pstayandgamma) shows how the estimated values of 
the parameters of the mobility model changed over the course of
the outbreak. Both these parameters were assumed to be constant
for the time frame over which model was fitted. It is interesting
to note that the change in estimated indicates decreased probability
of travel across national borders.

```{r pstayandgamma, echo = FALSE, fig.cap = "Estimates of mobility parameters at different points during the outbreak. The circle represents the central estimate and the horizontal bars reflect the 2.5 and 97.5 percentiles."}
knitr::include_graphics("ms-figures/gamma_pstay_over_tproj.png")
```
## Evaluation of the model performance

Figure \@ref(fig:assess) shows the metrics (bias,
sharpness, log of relative accuracy, and relative mean absolute error) 
discussed in Section \@ref{assess} for the 4 week projections in 
Guinea, Sierra Leone and Liberia using a 4-week window to estimate
reproduction number. Each metric was first computed using the daily
observed and predicted series and then averaged for each week of
projections.

Across all metrics, there is a strong trend of decreased model
performance as the forecast horizon increases. The bias in forecasts
at week 1 is closer to 0 at every time point. Similarly the forecasts
at week 1 are more sharp (sharpness close to 0) than at week 4. In
general, the model performs better in the growing phase of the
epidemic (defined as the window in which the 0.025th percentile of the
posterior distribution is greater than 1). In this phase, the
forecasts are generally greater than the observed incidence while in 
the descending phase (defined similarly as the window in which the 
0.975th percentile is less than 1), the model under-predicts. The
length of the calibration window did not have a significant impact on 
the model performance.




```{r assess, echo = FALSE, fig.cap = "Metrics for evaluating model performance.", fig.align = "center"}
knitr::include_graphics("ms-figures/forecasts_assess_28.png")
```
