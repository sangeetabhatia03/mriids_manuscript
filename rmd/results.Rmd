# Results {#results}

```{r echo = FALSE}
library(captioner)
si_fig_nums <- captioner(prefix = "(SI) Figure")
fig_nums <- captioner(prefix = "Figure")
tab_nums <- captioner(prefix = "Table")
```

## Processing ProMED/HealthMap data feed

We used a set of curated ProMED and HealthMap records on the human 
cases of Ebola in West Africa. 
The dates in the feeds ranged from March 2014 to October 2016.
The data set recorded the cumulative number of suspected/confirmed
cases and suspected/confirmed deaths by country at various dates
in this period. We derived the country specific daily and 
weekly incidence time series from these data after the 
following data cleaning and pre-processing:

+ We first extracted the total case
counts as a sum of suspected and confirmed cases. 
+ Each unique record 
in ProMED/HealthMap data is associated with a unique alert id.  Where
multiple records were associated with the same alert id, we merged
them by assigning the median of the case numbers to the record. In
some instances, cumulative case count was inconsistent in that it
failed to be monotonically increasing. Any record of a 
cumulative case number lower than a previous record was removed.
+ Finally, cumulative incidence on days with no records was
filled in using linear or log-linear interpolation. 

Further details and result of 
each step of the pre-processing of Promed and 
Healthmap data are presented in the supplementary text.

## Data collated by WHO

We used the incidence data collated by the WHO during the West 
African Ebola epidemic made available by [@garske20160308], 
later referred to as ``the WHO data'' in the interest of brevity. 
The cleaned version of the WHO data consisted of cases reported
between December 2013 and October 2015 in three most affected
countries - Guinea, Sierra Leone and Liberia. Location of residence 
was geo-coded to the second administrative level. However, as data
from ProMED and HealthMap were only available at the country level,
we aggregated the WHO data to national level for comparison.

## Comparison of incidence trends from different sources

```{r echo = FALSE, warning = FALSE}
incidrcite <- fig_nums(name = "incidrcompare",
                       display = "cite")
incidrcap <- fig_nums(name = "incidrcompare",
                      caption = "Comparison of daily incidence
trends and R estimates from ProMED, HealthMap and WHO data (A) Daily
incidence series derived from ProMED (blue), HealthMap (black) and WHO data (orange). The interpolated points for ProMED and HealthMap are shown in lighter shade of blue and black respectively. WHO data were aggergated to country level. (B) The mean
time-varying reproduction number estimated using the WHO data, ProMED (blue) and
HealthMap (black) data. The shaded region depicts the 95% CrI for the R estimate. A time window of 28 days for estimating R was used here.")

```

We compared the processed country-specific incidence time 
series derived  from ProMED and HealthMap data with the incidence data 
from the WHO data. Incidence time series and the reproduction numbers 
estimated using the
incidence from these various sources are shown in  
`r incidrcite` for the three mainly affected 
countries: Guinea, Liberia and Sierra Leone.  The instantaneous 
reproduction number was estimated independently for each country in
using the R package EpiEstim [@cori2013new] with a time window of 
4 weeks.


The weekly incidence time series derived from ProMED and HealthMap
data are highly correlated with the WHO incidence data (Pearson's 
correlation coefficient 0.44 and 0.74 respectively, p value < 0.001). 
The digital surveillance data differ significantly from the WHO data 
at the peak of the epidemic approximately in the first few months of 
2015. While the reasons for this discrepancy are not entirely clear, 
they could for instance reflect the susceptibility of digital surveillance to
biases in reporting. At the same time, it is important to remember
that the WHO data used here are an extensively cleaned
version of the data collected during the epidemic [@who2014ebola, 
@team2015west], published well after the epidemic was declared to be 
over. During the epidemic, the first situation report by the WHO 
was published only at the
end of August 2014 [@whositrep], reporting on cases between January 
and August 2014. On the other hand, the first post
on ProMED on Ebola cases in Guinea appeared in March 2014
[@pmfirstebola]


```{r echo = FALSE, fig.cap = incidrcap, fig.align = "center"}
knitr::include_graphics("ms-figures/who-hm-promed-comparison-20-1.png")
```


The estimates of the reproduction number are strongly influenced by
the choice of the time window (`r rcorrcite`). The correlation between 
mean R estimates from ProMED or HealthMap data with the estimates from 
WHO data varied from weak (0.13, time window of 2 weeks) to very strong 
(0.90, time window of 6 weeks).



## Short term projections

To project incidence at time $t$, we used the incidence data up to 
day $t - 1$. To estimate the time-varying reproduction number for 
each country, we divided the duration from day 1 to day $t - 1$ 
into time windows of equal width. 
Assuming that transmissibility in each location stays constant 
within each time window, we estimated 
a single reproduction number for each location for each time window. 
We varied the length of this time window from 1 week to 4 weeks 
to obtain different models. The forecast horizon was varied from
4 weeks to 8 weeks. 

```{r echo = FALSE, warning = FALSE}
g28cite <- fig_nums(name = "promed28",
                    display = "cite")

who28cite <- fig_nums(name = "who28",
                      display = "cite")

```


```{r stfigcap, echo = FALSE, warning = FALSE, message = FALSE}
mapcite <- fig_nums(name = "spatial",
                    display = "cite")

mapcap <- fig_nums(name = "spatial",
                   caption = "Spatial spread of the epidemic. The
observed and predicted spread of the epidemic in two weeks in late
2014.")

```

We also estimated retrosective transmissibilty using all the available 
data. The retrospective estimates of R agree reasonably well with the 
real time estimates of R (bottom two panels `r g28cite`). The model is
able to capture well the broad trends in the progress of the epidemic 
within each country (top panel `r g28cite`) as well as the
spatio-temporal spread (`r mapcite`). 
The forecasts and R estimates using WHO data are shown in `r who28cite`.

In the results presented in the main text, we used a time window of 14
days. Results from the model using other time windows and projection 
horizon are presented in the supplementary text.

```{r figcaps, echo = FALSE}
g28cap <- fig_nums(name = "promed28",
                   caption = "Observed and predicted
incidence, and reproduction number estimates from ProMED data.
The top panel shows the weekly incidence derived from ProMED
data and the 4 weeks incidence forecast on log scale.
The solid dots represent the observed weekly incidence where
the light blue dots show
weeks for which at least one data point was obtained using
interpolation. The projections are made over 4 week windows, based on the
reproduction number estimated in the previous 2 weeks.
The middle figure in each panel shows the reproduction number
used to make projections over each 4 week projection window.
The bottom figure shows the effective reproduction number estimated
retrospectively using the full dataset up to the end.
In each case, the solid gray line is the median
estimate and the shaded region represents the 95% CrI.")


who28cap <- fig_nums(name = "who28",
                   caption = "Observed and predicted
incidence, and reproduction number estimates from the WHO data.
The top panel shows the weekly incidence derived from the WHO
data and the 4 weeks incidence forecast on log scale.
The solid dots represent the observed weekly incidence.
The projections are made over 4 week windows, based on the
reproduction number estimated in the previous 2 weeks.
The middle figure in each panel shows the reproduction number
used to
make projections over each 4 week projection window.
The bottom figure shows the effective reproduction number estimated
retrospectively using the full dataset up to the end.
In each figure, the solid gray line is the median
estimate and the shaded region represents the 95% CrI.")

```

```{r echo = FALSE, fig.cap = g28cap, fig.align = "center"}
knitr::include_graphics("ms-figures/promed_projections-viz-fixed-country-14-1._14.png")
```



```{r echo = FALSE, fig.cap = who28cap, fig.align = "center"}
knitr::include_graphics("ms-figures/who_projections-viz-fixed-country-14-1._14.png")
```


```{r echo = FALSE, fig.cap = mapcap, fig.align = "center"}
knitr::include_graphics("ms-figures/whole_africa_MALI_nonzero.png")
```

```{r echo = FALSE, warning = FALSE}
parscite <- fig_nums(name = "pstayandgamma",
                     display = "cite")

parscap <- fig_nums(name = "pstayandgamma",
                    caption = "Estimates of mobility model parameters at
different points during the epidemic.
The circle represents the central estimate and the horizontal bars
represent the 2.5th and 97.5th percentiles.")
```
`r parscite` shows how the estimated values of 
the parameters of the mobility model changed over the course of
the outbreak. Both these parameters were assumed to be constant
for the time frame over which model was fitted and across all
countries. 

```{r echo = FALSE, fig.cap = parscap, fig.align = "center", fig.width = 3.4}
knitr::include_graphics("ms-figures/who_gamma_pstay_over_tproj_14.png")
```

It is interesting to note that the change in estimates over the course 
of the epidemic suggests a decreased probability of 
travel across national borders.



## Evaluation of the model performance

```{r echo = FALSE, warning = FALSE}
assesscite <- fig_nums(name = "assess", display = "cite")
assesscap <- fig_nums(name = "assess",
                      caption = "Metrics for evaluating model
performance where the projection horizon was 4 weeks.
The y-axis shows (anti-clockwise from top left)
bias, log relative accuracy, relative mean
absolute error and sharpness scores respectively. In the forward
projections, we assumed transmissibility to be constant over the
projection window. be If the 97.5th percentile of the R estimate used
was less than 1, we defined the epidemic to be in the declining phase
during this period. Similarly, if the 2.5th percentile of R was
greater than 1, we defined the epidemic to be in a growing phase.")
```
`r assesscite` shows the metrics (bias,
sharpness, log of relative accuracy, and relative mean absolute error) 
discussed earlier for the 4 week projections in 
Guinea, Sierra Leone and Liberia using a 4-week window to estimate
reproduction number. Each metric was first computed using the daily
observed and predicted series and then averaged across all weeks of
projections.

Across all metrics, there is a strong trend of decreased model
performance as the forecast horizon increases. The bias in forecasts
at week 1 is closer to 0 at every time point. Similarly the forecasts
at week 1 are more sharp (sharpness close to 0) than at week 4. In
general, the model performs better in the growing phase of the
epidemic (defined as the window in which the 0.025th percentile of the
posterior distribution of the reproduction number is greater than 1). 
In this phase, the
forecasts are generally greater than the observed incidence while in 
the declining phase (defined similarly as the window in which the 
0.975th R percentile is less than 1), the model tends to 
under-predict. The
length of the calibration window did not have a significant impact on 
the model performance.




```{r assess, echo = FALSE, fig.cap = assesscap, fig.align = "center"}
knitr::include_graphics("ms-figures/forecasts_assess_28.png")
```

```{r proponci, echo = FALSE, message = FALSE}
library(magrittr)
here::here("data/processed/promed_propinci_byphase.csv") %>%
    readr::read_csv() %>%
        flextable::flextable() 
```

